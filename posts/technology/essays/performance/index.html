<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>记一次性能测试 | 𝙅𝙕𝙔&#39;𝙨 𝘽𝙡𝙤𝙜𝙨</title>
<meta name="keywords" content="性能测试,JZY">
<meta name="description" content="杂乱的一篇">
<meta name="author" content="姜振园">
<link rel="canonical" href="http://192.168.9.98/posts/technology/essays/performance/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://192.168.9.98/img/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://192.168.9.98/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="http://192.168.9.98/favicon.ico">
<link rel="apple-touch-icon" href="http://192.168.9.98/favicon.ico">
<link rel="mask-icon" href="http://192.168.9.98/favicon.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://192.168.9.98/posts/technology/essays/performance/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  

<meta property="og:title" content="记一次性能测试" />
<meta property="og:description" content="杂乱的一篇" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://192.168.9.98/posts/technology/essays/performance/" />
<meta property="og:image" content="http://192.168.9.98/0.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-05-31T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://192.168.9.98/0.jpg" />
<meta name="twitter:title" content="记一次性能测试"/>
<meta name="twitter:description" content="杂乱的一篇"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "文章",
          "item": "http://192.168.9.98/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "技术",
          "item": "http://192.168.9.98/posts/technology/"
        },

        {
          "@type": "ListItem",
          "position":  3 ,
          "name": "随笔",
          "item": "http://192.168.9.98/posts/technology/essays/"
        }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "记一次性能测试",
      "item": "http://192.168.9.98/posts/technology/essays/performance/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "记一次性能测试",
  "name": "记一次性能测试",
  "description": "杂乱的一篇",
  "keywords": [
    "性能测试,JZY"
  ],
  "articleBody": "\r背景 我负责的一个项目经过长时间的开发，终于在客户现场正式运行了。 虽然正式运行前的很长一段时间里我一直在计划进行一次性能测试，但由于各种原因，测试一直没有进行。 我们的运维人员在正式运行前进行了试运行，结果在一定数量的并发下，硬盘顶不住，系统直接卡死了。 我就进行了一次性能测试。\n本文记录了我的大概测试思路及方法。\n影响项目性能的因素分析 这个项目的主要功能是对监控设备的视频流进行切片、存储，然后生成URL供平台调阅。它主要分为两个部分，切片系统、存储系统。项目中，不同存储方式导致项目架构不同。\n项目提供3中存储方式——本地存储、S3接口存储、智能云存储。其中，S3接口存储、智能云存储需额外配置存储服务器，与切片服务器分开，切片视频文件放在存储服务器中； 本地存储则不需额外配置存储服务器，直接把切片视频文件放在切片服务器中。\n进行性能测试，首先要知道影响项目性能的因素有那些。与研发沟通后，确定切片系统需关注cpu使用率、平均负载、内存使用。存储系统需关注存储cpu使用率、内存使用率、平均负载、系统读写带宽信息、硬盘读写带宽信息。 非本地存储时，还需关注切片服务器与存储服务器之间的网络宽带信息。\n策划初步测试方案 首先需要明确，此项目主要功能的流程。\n由此初步策划出两套测试方案\n第一套\n使用Jmeter下发切片指令，切片服务器中使用top命令获取切片服务器切片过程中的cpu、平均负载、内存等信息\n切片完成后。存储服务器中使用top命令获取切片视频存储过程中的cpu、平均负载、内存等信息，使用iostat命令获取切片视频存储过程中存储服务器存储过程中的硬盘信息；切片服务器中使用nload命令获取切片视频存储过程中的网络传输信息\n分析并整理获取到的所有信息\n制作成结果图表\n第二套\n使用Jmeter下发切片指令后，切片服务器中使用top命令获取切片服务器中的cpu、平均负载、内存等信息，使用iostat命令获取切片服务器存储过程中的硬盘信息\n分析并整理获取到的所有信息（分出切片、存储两个时间段）\n制作成结果图表\n搭建测试方案所需环境 以第一套为例：\n准备切片服务器\n服务器系统使用Linux系统\n服务器中部署切片服务\n服务器中安装iostat、nload\n准备存储服务器\n服务器中部署存储服务\n服务器中安装iostat\n编写服务器脚本，获取服务器信息\n服务器中编写所需top、iostat、nload脚本命令\n#!/bin/bash # top脚本，用于切片服务器、存储服务器 # 总循环时间（秒） total_time=$1 # 检查是否提供了总时间参数 if [ -z \"$total_time\" ]; then echo \"Usage: $0 \" exit 1 fi # 记录开始时间 start_time=$(date +%s) # 循环直到达到总时间 while true; do # 计算当前时间与开始时间的差值（秒） current_time=$(date +%s) elapsed_time=$((current_time - start_time)) # 如果已经达到或超过总时间，则退出循环 if [ $elapsed_time -ge $total_time ]; then break fi # 执行提供的命令 top -n 1 -b | head -n 6 \u003e\u003e /top.log # 睡眠2秒 sleep 2 done #!/bin/bash # iostat脚本，用于切片服务器、存储服务器 # 总持续时间（秒） total_time=$1 # 检查是否提供了总时间参数 if [ -z \"$total_time\" ]; then echo \"Usage: $0 \" exit 1 fi # 记录开始时间 start_time=$(date +%s) # 启动 iostat命令 并将输出重定向到日志文件，同时将其放入后台运行，根据需要写iostat。 (iostat -x -m -t 2 \u003e /iostat.log) \u0026 # 保存 nload 的进程ID PID=$! # 等待$1秒 sleep $1 # 终止 iostat 进程 kill $PID #!/bin/bash # nload脚本，用于切片服务器 # 总持续时间（秒） total_time=$1 # 检查是否提供了总时间参数 if [ -z \"$total_time\" ]; then echo \"Usage: $0 \" exit 1 fi # 启动 nload 并将输出重定向到日志文件，同时将其放入后台运行 (nload eno1 -u M -m -t 1500 \u003e /nload.log) \u0026 # 保存 nload 的进程ID PID=$! # 等待60秒 sleep $1 # 终止 nload 进程 kill $PID 使用python编写服务远程执行top、iostat脚本\n主要为了一键自动化，不需要自己手动执行top、iostat脚本。\n思路是，使用Flask实现一个前置服务，Jmeter下发切片指令前请求前置服务，自动远程执行top、iostat等脚本。\n代码如下：\n# Getdata.py import paramiko import time import threading from flask import Blueprint, jsonify, request GetData = Blueprint('GetData', __name__, template_folder='templates') def create_ssh_client(hostname, port, username, private_key_path): \"\"\"创建并返回一个SSH客户端的辅助函数。\"\"\" private_key = paramiko.RSAKey.from_private_key_file(private_key_path) client = paramiko.SSHClient() client.set_missing_host_key_policy(paramiko.AutoAddPolicy()) client.connect(hostname, port=port, username=username, pkey=private_key) return client def execute_command_async(client, command): \"\"\"在SSH客户端上执行命令的辅助函数。\"\"\" stdin, stdout, stderr = client.exec_command(command) stdout.channel.recv_exit_status() def fetch_files(ssh_client, remote_path, local_path): \"\"\"从远程服务器拉取文件的辅助函数。\"\"\" try: with ssh_client.open_sftp() as sftp_client: sftp_client.get(remote_path, local_path) print(f\"成功获取 {remote_path} 到 {local_path}\") except Exception as e: print(f\"获取 {remote_path} 时出错: {e}\") def delete_remote_files(client, filenames): \"\"\"删除远程服务器上的文件的辅助函数。\"\"\" for filename in filenames: client.exec_command(f'rm {filename}') def test165(long, client, hostname_command): \"\"\"切片快结束时，执行存储服务器上的脚本。\"\"\"\ttime.sleep(long - 10) execute_command_async(client, hostname_command) @GetData.route('/api/GetTop/', methods=['GET']) def gettop(): \"\"\"获取切片时长\"\"\" long = int(request.args.get(\"time\")) print(long) \"\"\"定义脚本执行时长\"\"\" shi = 600 def background_task(): \"\"\"定义服务器的信息\"\"\" hostname1 = '192.168.1.111' hostname2 = '192.168.1.112' port = 22 username = 'root' private_key_path = r\"C:\\Users\\Ethereal Jiang\\.ssh\\id_rsa\" \"\"\"实例化ssh客户端并执行脚本命令。使用多线程是两个服务器互不影响。\"\"\" client1 = None client2 = None try: client1 = create_ssh_client(hostname1, port, username, private_key_path) client2 = create_ssh_client(hostname2, port, username, private_key_path) hostname1_command = f'bash /opt/top_start.sh {long + shi} \u0026 bash /opt/iostat_start.sh {long + shi}' hostname2_command = f'bash /opt/top_start.sh {shi} \u0026 bash /opt/iostat_start.sh {shi}' thread1 = threading.Thread(target=execute_command_async, args=(client1, hostname1_command)) thread2 = threading.Thread(target=test165, args=(long, client2, hostname2_command)) thread1.start() thread2.start() thread1.join() thread2.join() except Exception as e: print(f\"An error occurred: {e}\") finally: if not client1: client1 = create_ssh_client(hostname1, port, username, private_key_path) if not client2: client2 = create_ssh_client(hostname1, port, username, private_key_path) fetch_files(client2, '/top.log', 'D:\\\\test\\\\165\\\\top.log') fetch_files(client2, '/iostat.log', 'D:\\\\test\\\\165\\\\iostat.log') delete_remote_files(client2, ['/top.log', '/iostat.log']) fetch_files(client1, '/top.log', 'D:\\\\test\\\\169\\\\top.log') fetch_files(client1, '/iostat.log', 'D:\\\\test\\\\169\\\\iostat.log') delete_remote_files(client1, ['/top.log', '/iostat.log']) if client1: client1.close() if client2: client2.close() print('结束' + str(time.time())) task_thread = threading.Thread(target=background_task) task_thread.start() return jsonify({\"status\": \"任务已开始在后台处理\"}), 202 # app.py from flask import Flask from Getdata import GetData app = Flask(__name__) app.secret_key = 'jiang' app.register_blueprint(GetData) if __name__ == '__main__': app.run() 编写Jmeter脚本，下发切片指令\n运行脚本后，首先会请求前置服务，执行服务器脚本，然后，开始并发切片指令。结束后，前置服务自动拉取信息文件到本地。\n测试结束后后，分析、整理本地数据 每次并发测试三轮，信息文件放在对应的文件夹中。使用Notepad++和WPS表格处理数据。\nNotepad++查询复制数据，WPS表格分列数据\n将分析整理后的数据制作成图表 我使用的是cdn库的Chart.js，还是比较强的，可以访问Chart.js学习使用。示例如下：\n\u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003cmeta charset=\"utf-8\"\u003e \u003ctitle\u003e性能测试\u003c/title\u003e \u003cscript src=\"https://cdn.staticfile.net/Chart.js/3.9.1/chart.js\"\u003e\u003c/script\u003e \u003cscript src=\"https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0\"\u003e\u003c/script\u003e \u003cstyle\u003e body { background: #9e9e9e1a; margin: 0; /* 移除默认的外边距 */ } .card { padding: 0 3%; background: #fff; border: 1px solid #dcdee2; border-color: #e8eaec; border-radius: 15px; width: 80%; /* 设置左右边距为自动 */ margin: 2% auto; } .data { margin-top: 2%; margin-bottom: 4%; } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv class=\"card\"\u003e \u003cdiv class=\"data\"\u003e \u003cspan\u003e5个并发\u003c/span\u003e \u003ccanvas id=\"c5_169\"\u003e\u003c/canvas\u003e \u003c/div\u003e \u003cdiv class=\"data\"\u003e \u003ccanvas id=\"c5_165\" \u003e\u003c/canvas\u003e \u003c/div\u003e \u003c/div\u003e \u003cscript\u003e // 并发5 const c5_169_Ctx = document.getElementById('c5_169'); const c5_169_Labels = ['%错误率', '切片-%CPU最大使用率', '切片-CPU最大负载(1分钟)','切片-内存最大使用-GiB', '平均宽带速率-MByte/s', '最小宽带速率-MByte/s', '最大宽带速率-MByte/s', '视频总体积-GByte', '总流程时间(分)', '存储写入时长(分)', '存储-%CPU最大使用率', '存储-CPU最大负载(1分钟)', '存储-内存最大使用率-GiB' ]; // 设置 X 轴上对应的标签 const c5_169_Data = { labels: c5_169_Labels, datasets: [{ label: '结果', data: [0, 11.16666667, 0.906666667, 6.707091217, 53.87263617, 8.97, 69.28666667, 1.86, 10.61666667, 0.555555556, 20.66666667, 1.936666667, 24.95719945], backgroundColor: [ 'rgba(255, 99, 132, 0.2)', // 粉色 'rgba(255, 159, 64, 0.2)', // 橙色 'rgba(255, 205, 86, 0.2)', // 浅黄色 'rgba(75, 192, 192, 0.2)', // 青绿色 'rgba(153, 102, 255, 0.2)', // 紫罗兰 'rgba(255, 206, 86, 0.2)', // 金色 'rgba(75, 191, 92, 0.2)', // 橄榄绿 'rgba(120, 75, 192, 0.2)', // 深紫罗兰 'rgba(255, 92, 159, 0.2)', // 品红色 'rgba(92, 255, 206, 0.2)', // 浅绿松石色 'rgba(206, 92, 255, 0.2)', // 浅洋红色 'rgba(159, 255, 92, 0.2)', // 浅黄色绿色 'rgba(102, 86, 255, 0.2)' // 浅灰蓝色 ], borderColor: [ 'rgb(255, 99, 132)', // 粉色 'rgb(255, 159, 64)', // 橙色 'rgb(255, 205, 86)', // 浅黄色 'rgb(75, 192, 192)', // 青绿色 'rgb(153, 102, 255)', // 紫罗兰 'rgb(255, 206, 86)', // 金色 'rgb(75, 191, 92)', // 橄榄绿 'rgb(120, 75, 192)', // 深紫罗兰 'rgb(255, 92, 159)', // 品红色 'rgb(92, 255, 206)', // 浅绿松石色 'rgb(206, 92, 255)', // 浅洋红色 'rgb(159, 255, 92)', // 浅黄色绿色 'rgb(102, 86, 255)' // 浅灰蓝色 ], borderWidth: 1 // 设置线条宽度 }] }; const c5_169_Config = { type: 'bar', // 设置图表类型 data: c5_169_Data, // 设置数据集 options: { scales: { y: { beginAtZero: true // 设置 y 轴从 0 开始 } }, plugins: { title: { display: true, text: '' // 这里设置图表的标题 }, datalabels: { anchor: 'end', align: 'top', formatter: function(value, context) { return value.toFixed(2); // 设置标签格式 } } } }, plugins: [ChartDataLabels] }; const c5_169_Chart = new Chart(c5_169_Ctx, c5_169_Config); const c5_165_ctx = document.getElementById('c5_165'); const c5_165_labels = ['avg-wMB/s', 'min-wMB/s', 'max-wMB/s','avg-w_await', 'min-w_await', 'max-w_await', 'avg-%util', 'min-%util', 'max-%util']; // 设置 X 轴上对应的标签 const c5_165_data = { labels: c5_165_labels, datasets: [{ label: 'sdb', data: [52.36925926, 5.89, 83.85, 28.26445534, 8.703333333, 59.62, 89.57178649, 28.28333333, 98.7], backgroundColor: [ // 设置每个柱形图的背景颜色 'rgba(55, 163, 236, 0.2)', 'rgba(76, 193, 192, 0.2)', 'rgba(256, 205, 87, 0.2)', 'rgba(152, 103, 254, 0.2)', 'rgba(254, 160, 65, 0.2)', 'rgba(254, 100, 133, 0.2)', 'rgba(154, 101, 254, 0.2)', 'rgba(254, 160, 66, 0.2)', 'rgba(254, 98, 133, 0.2)' ], borderColor: [ //设置每个柱形图边框线条颜色 'rgba(55, 163, 236)', 'rgba(76, 193, 192)', 'rgba(256, 205, 87)', 'rgba(152, 103, 254)', 'rgba(254, 160, 65)', 'rgba(254, 100, 133)', 'rgba(154, 101, 254)', 'rgba(254, 160, 66)', 'rgba(254, 98, 133)' ], borderWidth: 1 // 设置线条宽度 }, { label: 'sdc', data: [52.37021786, 6.886666667, 83.69333333, 26.18413943, 7.443333333, 60.51333333, 87.21247277, 23.35, 97.43333333], backgroundColor: [ // 设置每个柱形图的背景颜色 'rgba(55, 163, 236, 0.2)', 'rgba(76, 193, 192, 0.2)', 'rgba(256, 205, 87, 0.2)', 'rgba(152, 103, 254, 0.2)', 'rgba(254, 160, 65, 0.2)', 'rgba(254, 100, 133, 0.2)', 'rgba(154, 101, 254, 0.2)', 'rgba(254, 160, 66, 0.2)', 'rgba(254, 98, 133, 0.2)' ], borderColor: [ //设置每个柱形图边框线条颜色 'rgba(55, 163, 236)', 'rgba(76, 193, 192)', 'rgba(256, 205, 87)', 'rgba(152, 103, 254)', 'rgba(254, 160, 65)', 'rgba(254, 100, 133)', 'rgba(154, 101, 254)', 'rgba(254, 160, 66)', 'rgba(254, 98, 133)' ], borderWidth: 1 // 设置线条宽度 }, { label: 'sdd', data: [52.37001089, 6.553333333, 83.18666667, 26.98811547, 8.673333333, 56.51, 89.42472767, 26.16666667, 98.3], backgroundColor: [ // 设置每个柱形图的背景颜色 'rgba(55, 163, 236, 0.2)', 'rgba(76, 193, 192, 0.2)', 'rgba(256, 205, 87, 0.2)', 'rgba(152, 103, 254, 0.2)', 'rgba(254, 160, 65, 0.2)', 'rgba(254, 100, 133, 0.2)', 'rgba(154, 101, 254, 0.2)', 'rgba(254, 160, 66, 0.2)', 'rgba(254, 98, 133, 0.2)' ], borderColor: [ //设置每个柱形图边框线条颜色 'rgba(55, 163, 236)', 'rgba(76, 193, 192)', 'rgba(256, 205, 87)', 'rgba(152, 103, 254)', 'rgba(254, 160, 65)', 'rgba(254, 100, 133)', 'rgba(154, 101, 254)', 'rgba(254, 160, 66)', 'rgba(254, 98, 133)' ], borderWidth: 1 // 设置线条宽度 }] }; const c5_165_config = { type: 'bar', // 设置图表类型 data: c5_165_data, // 设置数据集 options: { scales: { y: { beginAtZero: true // 设置 y 轴从 0 开始 } }, plugins: { title: { display: true, text: '存储-硬盘信息' // 这里设置图表的标题 }, datalabels: { anchor: 'end', align: 'top', formatter: function(value, context) { return value.toFixed(2); // 设置标签格式 } } } }, plugins: [ChartDataLabels] }; const c5_165_Chart = new Chart(c5_165_ctx, c5_165_config); \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e 效果还是挺好的。\n",
  "wordCount" : "3815",
  "inLanguage": "zh",
  "image":"http://192.168.9.98/0.jpg","datePublished": "2024-05-28T00:00:00Z",
  "dateModified": "2024-05-31T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "姜振园"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://192.168.9.98/posts/technology/essays/performance/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "𝙅𝙕𝙔'𝙨 𝘽𝙡𝙤𝙜𝙨",
    "logo": {
      "@type": "ImageObject",
      "url": "http://192.168.9.98/img/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://192.168.9.98/" accesskey="h" title="𝙅𝙕𝙔&#39;𝙨 𝘽𝙡𝙤𝙜𝙨 (Alt + H)">
            <img src="http://192.168.9.98/img/favicon.png" alt="logo" aria-label="logo"
                 height="35">𝙅𝙕𝙔&#39;𝙨 𝘽𝙡𝙤𝙜𝙨</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://192.168.9.98/" title="主页">
                <span>主页</span>
                </a>
            </li>
            <li>
                <a href="http://192.168.9.98/posts" title="文章">
                <span>文章</span>
                </a>
            </li>
            <li>
                <a href="http://192.168.9.98/search" title="搜索 (Alt &#43; /)" accesskey=/>
                <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://192.168.9.98/archives/" title="时间轴">
                <span>时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://192.168.9.98/tags" title="标签">
                <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://192.168.9.98/about" title="关于">
                <span>关于</span>
                </a>
            </li>
			<li>
                <a href="https://www.jzy-blogs.cn/music.html" target="_blank" title="音乐">
                <span>音乐</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="http://192.168.9.98/">主页</a>&nbsp;»&nbsp;<a href="http://192.168.9.98/posts/">文章</a>&nbsp;»&nbsp;<a href="http://192.168.9.98/posts/technology/">技术</a>&nbsp;»&nbsp;<a href="http://192.168.9.98/posts/technology/essays/">随笔</a></div>
            <h1 class="post-title">
                记一次性能测试
            </h1>
            <div class="post-description">
                杂乱的一篇
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2024-05-28
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_2">
        <span class="fa fa-calendar-plus-o"></span>
        <span>2024-05-31
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>3815字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>8分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>姜振园
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="http://192.168.9.98/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" style="color: var(--secondary)!important;">性能测试</a>
            </span>
        </span>
    </span>
</span>
&nbsp;&nbsp;
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "http://192.168.9.98/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%83%8c%e6%99%af" aria-label="背景">背景</a></li>
                <li>
                    <a href="#%e5%bd%b1%e5%93%8d%e9%a1%b9%e7%9b%ae%e6%80%a7%e8%83%bd%e7%9a%84%e5%9b%a0%e7%b4%a0%e5%88%86%e6%9e%90" aria-label="影响项目性能的因素分析">影响项目性能的因素分析</a></li>
                <li>
                    <a href="#%e7%ad%96%e5%88%92%e5%88%9d%e6%ad%a5%e6%b5%8b%e8%af%95%e6%96%b9%e6%a1%88" aria-label="策划初步测试方案">策划初步测试方案</a></li>
                <li>
                    <a href="#%e6%90%ad%e5%bb%ba%e6%b5%8b%e8%af%95%e6%96%b9%e6%a1%88%e6%89%80%e9%9c%80%e7%8e%af%e5%a2%83" aria-label="搭建测试方案所需环境">搭建测试方案所需环境</a></li>
                <li>
                    <a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9d%9f%e5%90%8e%e5%90%8e%e5%88%86%e6%9e%90%e6%95%b4%e7%90%86%e6%9c%ac%e5%9c%b0%e6%95%b0%e6%8d%ae" aria-label="测试结束后后，分析、整理本地数据">测试结束后后，分析、整理本地数据</a></li>
                <li>
                    <a href="#%e5%b0%86%e5%88%86%e6%9e%90%e6%95%b4%e7%90%86%e5%90%8e%e7%9a%84%e6%95%b0%e6%8d%ae%e5%88%b6%e4%bd%9c%e6%88%90%e5%9b%be%e8%a1%a8" aria-label="将分析整理后的数据制作成图表">将分析整理后的数据制作成图表</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        if (elements) {
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement){
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content">
<img src="/posts/technology/essays/performance/0.jpg" alt="">

<h2 id="背景">背景<a hidden class="anchor" aria-hidden="true" href="#背景">#</a></h2>
<p>我负责的一个项目经过长时间的开发，终于在客户现场正式运行了。
虽然正式运行前的很长一段时间里我一直在计划进行一次性能测试，但由于各种原因，测试一直没有进行。
我们的运维人员在正式运行前进行了试运行，结果在一定数量的并发下，硬盘顶不住，系统直接卡死了。
我就进行了一次性能测试。</p>
<p>本文记录了我的大概测试思路及方法。</p>
<br>
<h2 id="影响项目性能的因素分析">影响项目性能的因素分析<a hidden class="anchor" aria-hidden="true" href="#影响项目性能的因素分析">#</a></h2>
<p>这个项目的主要功能是对监控设备的视频流进行切片、存储，然后生成URL供平台调阅。它主要分为两个部分，<code>切片系统、存储系统</code>。项目中，不同存储方式导致项目架构不同。</p>
<p>项目提供3中存储方式——<code>本地存储、S3接口存储、智能云存储</code>。其中，<code>S3接口存储、智能云存储</code>需额外配置存储服务器，与切片服务器分开，切片视频文件放在存储服务器中；
<code>本地存储</code>则不需额外配置存储服务器，直接把切片视频文件放在切片服务器中。</p>
<p>进行性能测试，首先要知道影响项目性能的因素有那些。与研发沟通后，确定切片系统需关注<code>cpu使用率、平均负载、内存使用</code>。存储系统需关注存储<code>cpu使用率、内存使用率、平均负载、系统读写带宽信息、硬盘读写带宽信息</code>。
非<code>本地存储</code>时，还需关注切片服务器与存储服务器之间的<code>网络宽带信息</code>。</p>
<br>
<h2 id="策划初步测试方案">策划初步测试方案<a hidden class="anchor" aria-hidden="true" href="#策划初步测试方案">#</a></h2>
<p>首先需要明确，此项目主要功能的流程。</p>
<p><div class="bigImg"><img loading="lazy" src="1.png" alt=""  /></div>
</p>
<p><strong>由此初步策划出两套测试方案</strong></p>
<ul>
<li>
<p><strong>第一套</strong></p>
<ol>
<li>
<p><code>使用Jmeter下发切片指令，切片服务器中使用top命令获取切片服务器切片过程中的cpu、平均负载、内存等信息</code></p>
</li>
<li>
<p><code>切片完成后。存储服务器中使用top命令获取切片视频存储过程中的cpu、平均负载、内存等信息，使用iostat命令获取切片视频存储过程中存储服务器存储过程中的硬盘信息；切片服务器中使用nload命令获取切片视频存储过程中的网络传输信息</code></p>
</li>
<li>
<p><code>分析并整理获取到的所有信息</code></p>
</li>
<li>
<p><code>制作成结果图表</code></p>
</li>
</ol>
</li>
<li>
<p><strong>第二套</strong></p>
<ol>
<li>
<p><code>使用Jmeter下发切片指令后，切片服务器中使用top命令获取切片服务器中的cpu、平均负载、内存等信息，使用iostat命令获取切片服务器存储过程中的硬盘信息</code></p>
</li>
<li>
<p><code>分析并整理获取到的所有信息（分出切片、存储两个时间段）</code></p>
</li>
<li>
<p><code>制作成结果图表</code></p>
</li>
</ol>
</li>
</ul>
<br>
<h2 id="搭建测试方案所需环境">搭建测试方案所需环境<a hidden class="anchor" aria-hidden="true" href="#搭建测试方案所需环境">#</a></h2>
<p><strong>以第一套为例：</strong></p>
<ol>
<li>
<p><strong>准备切片服务器</strong></p>
<ol>
<li>
<p><code>服务器系统使用Linux系统</code></p>
</li>
<li>
<p><code>服务器中部署切片服务</code></p>
</li>
<li>
<p><code>服务器中安装iostat、nload</code></p>
</li>
</ol>
</li>
<li>
<p><strong>准备存储服务器</strong></p>
<ol>
<li>
<p><code>服务器中部署存储服务</code></p>
</li>
<li>
<p><code>服务器中安装iostat</code></p>
</li>
</ol>
</li>
<li>
<p><strong>编写服务器脚本，获取服务器信息</strong></p>
<ol>
<li>
<p><code>服务器中编写所需top、iostat、nload脚本命令</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Shell" data-lang="Shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># top脚本，用于切片服务器、存储服务器</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 总循环时间（秒）</span>
</span></span><span style="display:flex;"><span>total_time<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 检查是否提供了总时间参数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$total_time<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> &lt;total_time&gt;&#34;</span>
</span></span><span style="display:flex;"><span>	exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 记录开始时间</span>
</span></span><span style="display:flex;"><span>start_time<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 循环直到达到总时间</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> true; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 计算当前时间与开始时间的差值（秒）</span>
</span></span><span style="display:flex;"><span>	current_time<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	elapsed_time<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span>current_time <span style="color:#f92672">-</span> start_time<span style="color:#66d9ef">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 如果已经达到或超过总时间，则退出循环</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $elapsed_time -ge $total_time <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>		break
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 执行提供的命令</span>
</span></span><span style="display:flex;"><span>	top -n <span style="color:#ae81ff">1</span> -b | head -n <span style="color:#ae81ff">6</span> &gt;&gt; /top.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 睡眠2秒</span>
</span></span><span style="display:flex;"><span>	sleep <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Shell" data-lang="Shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># iostat脚本，用于切片服务器、存储服务器</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 总持续时间（秒）</span>
</span></span><span style="display:flex;"><span>total_time<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 检查是否提供了总时间参数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$total_time<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> &lt;total_time&gt;&#34;</span>
</span></span><span style="display:flex;"><span>	exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 记录开始时间</span>
</span></span><span style="display:flex;"><span>start_time<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +%s<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动 iostat命令 并将输出重定向到日志文件，同时将其放入后台运行，根据需要写iostat。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>iostat -x -m -t <span style="color:#ae81ff">2</span> &gt; /iostat.log<span style="color:#f92672">)</span> &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 保存 nload 的进程ID</span>
</span></span><span style="display:flex;"><span>PID<span style="color:#f92672">=</span>$!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 等待$1秒</span>
</span></span><span style="display:flex;"><span>sleep $1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 终止 iostat 进程</span>
</span></span><span style="display:flex;"><span>kill $PID
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Shell" data-lang="Shell"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># nload脚本，用于切片服务器</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 总持续时间（秒）</span>
</span></span><span style="display:flex;"><span>total_time<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 检查是否提供了总时间参数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$total_time<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> &lt;total_time&gt;&#34;</span>
</span></span><span style="display:flex;"><span>	exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动 nload 并将输出重定向到日志文件，同时将其放入后台运行</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>nload eno1 -u M -m -t <span style="color:#ae81ff">1500</span> &gt; /nload.log<span style="color:#f92672">)</span> &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 保存 nload 的进程ID</span>
</span></span><span style="display:flex;"><span>PID<span style="color:#f92672">=</span>$!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 等待60秒</span>
</span></span><span style="display:flex;"><span>sleep $1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 终止 nload 进程</span>
</span></span><span style="display:flex;"><span>kill $PID
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p><strong>使用python编写服务远程执行top、iostat脚本</strong></p>
<p>主要为了一键自动化，不需要自己手动执行top、iostat脚本。</p>
<p>思路是，使用Flask实现一个前置服务，Jmeter下发切片指令前请求前置服务，自动远程执行top、iostat等脚本。</p>
<p><strong>代码如下：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Getdata.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> paramiko
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> threading
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Blueprint, jsonify, request
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GetData <span style="color:#f92672">=</span> Blueprint(<span style="color:#e6db74">&#39;GetData&#39;</span>, __name__, template_folder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;templates&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_ssh_client</span>(hostname, port, username, private_key_path):
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;创建并返回一个SSH客户端的辅助函数。&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	private_key <span style="color:#f92672">=</span> paramiko<span style="color:#f92672">.</span>RSAKey<span style="color:#f92672">.</span>from_private_key_file(private_key_path)
</span></span><span style="display:flex;"><span>	client <span style="color:#f92672">=</span> paramiko<span style="color:#f92672">.</span>SSHClient()
</span></span><span style="display:flex;"><span>	client<span style="color:#f92672">.</span>set_missing_host_key_policy(paramiko<span style="color:#f92672">.</span>AutoAddPolicy())
</span></span><span style="display:flex;"><span>	client<span style="color:#f92672">.</span>connect(hostname, port<span style="color:#f92672">=</span>port, username<span style="color:#f92672">=</span>username, pkey<span style="color:#f92672">=</span>private_key)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">execute_command_async</span>(client, command):
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;在SSH客户端上执行命令的辅助函数。&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	stdin, stdout, stderr <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>exec_command(command)
</span></span><span style="display:flex;"><span>	stdout<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>recv_exit_status()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fetch_files</span>(ssh_client, remote_path, local_path):
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;从远程服务器拉取文件的辅助函数。&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">with</span> ssh_client<span style="color:#f92672">.</span>open_sftp() <span style="color:#66d9ef">as</span> sftp_client:
</span></span><span style="display:flex;"><span>			sftp_client<span style="color:#f92672">.</span>get(remote_path, local_path)
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;成功获取 </span><span style="color:#e6db74">{</span>remote_path<span style="color:#e6db74">}</span><span style="color:#e6db74"> 到 </span><span style="color:#e6db74">{</span>local_path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;获取 </span><span style="color:#e6db74">{</span>remote_path<span style="color:#e6db74">}</span><span style="color:#e6db74"> 时出错: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete_remote_files</span>(client, filenames):
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;删除远程服务器上的文件的辅助函数。&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> filename <span style="color:#f92672">in</span> filenames:
</span></span><span style="display:flex;"><span>		client<span style="color:#f92672">.</span>exec_command(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;rm </span><span style="color:#e6db74">{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test165</span>(long, client, hostname_command):
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;切片快结束时，执行存储服务器上的脚本。&#34;&#34;&#34;</span>	
</span></span><span style="display:flex;"><span>	time<span style="color:#f92672">.</span>sleep(long <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>	execute_command_async(client, hostname_command)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@GetData.route</span>(<span style="color:#e6db74">&#39;/api/GetTop/&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gettop</span>():
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;获取切片时长&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	long <span style="color:#f92672">=</span> int(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;time&#34;</span>))
</span></span><span style="display:flex;"><span>	print(long)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;&#34;&#34;定义脚本执行时长&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	shi <span style="color:#f92672">=</span> <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">background_task</span>():
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;&#34;&#34;定义服务器的信息&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		hostname1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;192.168.1.111&#39;</span>
</span></span><span style="display:flex;"><span>		hostname2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;192.168.1.112&#39;</span>
</span></span><span style="display:flex;"><span>		port <span style="color:#f92672">=</span> <span style="color:#ae81ff">22</span>
</span></span><span style="display:flex;"><span>		username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;root&#39;</span>
</span></span><span style="display:flex;"><span>		private_key_path <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;C:\Users\Ethereal Jiang\.ssh\id_rsa&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;&#34;&#34;实例化ssh客户端并执行脚本命令。使用多线程是两个服务器互不影响。&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		client1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>		client2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>			client1 <span style="color:#f92672">=</span> create_ssh_client(hostname1, port, username, private_key_path)
</span></span><span style="display:flex;"><span>			client2 <span style="color:#f92672">=</span> create_ssh_client(hostname2, port, username, private_key_path)
</span></span><span style="display:flex;"><span>			hostname1_command <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;bash /opt/top_start.sh </span><span style="color:#e6db74">{</span>long <span style="color:#f92672">+</span> shi<span style="color:#e6db74">}</span><span style="color:#e6db74"> &amp; bash /opt/iostat_start.sh </span><span style="color:#e6db74">{</span>long <span style="color:#f92672">+</span> shi<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>			hostname2_command <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;bash /opt/top_start.sh </span><span style="color:#e6db74">{</span>shi<span style="color:#e6db74">}</span><span style="color:#e6db74"> &amp; bash /opt/iostat_start.sh </span><span style="color:#e6db74">{</span>shi<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>			thread1 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>execute_command_async, args<span style="color:#f92672">=</span>(client1, hostname1_command))
</span></span><span style="display:flex;"><span>			thread2 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>test165, args<span style="color:#f92672">=</span>(long, client2, hostname2_command))
</span></span><span style="display:flex;"><span>			thread1<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>			thread2<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>			thread1<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>			thread2<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;An error occurred: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> client1:
</span></span><span style="display:flex;"><span>				client1 <span style="color:#f92672">=</span> create_ssh_client(hostname1, port, username, private_key_path)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> client2:
</span></span><span style="display:flex;"><span>				client2 <span style="color:#f92672">=</span> create_ssh_client(hostname1, port, username, private_key_path)
</span></span><span style="display:flex;"><span>			fetch_files(client2, <span style="color:#e6db74">&#39;/top.log&#39;</span>, <span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">test</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">165</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">top.log&#39;</span>)
</span></span><span style="display:flex;"><span>			fetch_files(client2, <span style="color:#e6db74">&#39;/iostat.log&#39;</span>, <span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">test</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">165</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">iostat.log&#39;</span>)
</span></span><span style="display:flex;"><span>			delete_remote_files(client2, [<span style="color:#e6db74">&#39;/top.log&#39;</span>, <span style="color:#e6db74">&#39;/iostat.log&#39;</span>])
</span></span><span style="display:flex;"><span>			fetch_files(client1, <span style="color:#e6db74">&#39;/top.log&#39;</span>, <span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">test</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">169</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">top.log&#39;</span>)
</span></span><span style="display:flex;"><span>			fetch_files(client1, <span style="color:#e6db74">&#39;/iostat.log&#39;</span>, <span style="color:#e6db74">&#39;D:</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">test</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">169</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">iostat.log&#39;</span>)
</span></span><span style="display:flex;"><span>			delete_remote_files(client1, [<span style="color:#e6db74">&#39;/top.log&#39;</span>, <span style="color:#e6db74">&#39;/iostat.log&#39;</span>])
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> client1:
</span></span><span style="display:flex;"><span>				client1<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> client2:
</span></span><span style="display:flex;"><span>				client2<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#39;结束&#39;</span> <span style="color:#f92672">+</span> str(time<span style="color:#f92672">.</span>time()))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	task_thread <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>background_task)
</span></span><span style="display:flex;"><span>	task_thread<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> jsonify({<span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#e6db74">&#34;任务已开始在后台处理&#34;</span>}), <span style="color:#ae81ff">202</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># app.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Getdata <span style="color:#f92672">import</span> GetData
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(__name__)
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>secret_key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;jiang&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>register_blueprint(GetData)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>	app<span style="color:#f92672">.</span>run()
</span></span></code></pre></div></li>
<li>
<p><strong>编写Jmeter脚本，下发切片指令</strong></p>
<p><div class="bigImg"><img loading="lazy" src="2.png" alt=""  /></div>
</p>
<p>运行脚本后，首先会请求前置服务，执行服务器脚本，然后，开始并发切片指令。结束后，前置服务自动拉取信息文件到本地。</p>
</li>
</ol>
<br>
<h2 id="测试结束后后分析整理本地数据">测试结束后后，分析、整理本地数据<a hidden class="anchor" aria-hidden="true" href="#测试结束后后分析整理本地数据">#</a></h2>
<p>每次并发测试三轮，信息文件放在对应的文件夹中。使用Notepad++和WPS表格处理数据。</p>
<p><strong>Notepad++查询复制数据，WPS表格分列数据</strong></p>
<p><div class="bigImg"><img loading="lazy" src="3.png" alt=""  /></div>
</p>
<br>
<h2 id="将分析整理后的数据制作成图表">将分析整理后的数据制作成图表<a hidden class="anchor" aria-hidden="true" href="#将分析整理后的数据制作成图表">#</a></h2>
<p>我使用的是cdn库的<code>Chart.js</code>，还是比较强的，可以访问<a href="https://chart.nodejs.cn/">Chart.js</a>学习使用。示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">title</span>&gt;性能测试&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.staticfile.net/Chart.js/3.9.1/chart.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#9e9e9e</span><span style="color:#ae81ff">1</span>a;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>; <span style="color:#75715e">/* 移除默认的外边距 */</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	.<span style="color:#a6e22e">card</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">3</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#fff</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">border</span>: <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#66d9ef">solid</span> <span style="color:#ae81ff">#dcdee2</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">border-color</span>: <span style="color:#ae81ff">#e8eaec</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">15</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">80</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">/* 设置左右边距为自动 */</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">%</span> <span style="color:#66d9ef">auto</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	.<span style="color:#a6e22e">data</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">margin-top</span>: <span style="color:#ae81ff">2</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">4</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card&#34;</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;data&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">span</span>&gt;5个并发&lt;/<span style="color:#f92672">span</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;c5_169&#34;</span>&gt;&lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;data&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">canvas</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;c5_165&#34;</span> &gt;&lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 并发5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_169_Ctx</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;c5_169&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_169_Labels</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;%错误率&#39;</span>, <span style="color:#e6db74">&#39;切片-%CPU最大使用率&#39;</span>, <span style="color:#e6db74">&#39;切片-CPU最大负载(1分钟)&#39;</span>,<span style="color:#e6db74">&#39;切片-内存最大使用-GiB&#39;</span>, <span style="color:#e6db74">&#39;平均宽带速率-MByte/s&#39;</span>, <span style="color:#e6db74">&#39;最小宽带速率-MByte/s&#39;</span>, <span style="color:#e6db74">&#39;最大宽带速率-MByte/s&#39;</span>, <span style="color:#e6db74">&#39;视频总体积-GByte&#39;</span>, <span style="color:#e6db74">&#39;总流程时间(分)&#39;</span>, <span style="color:#e6db74">&#39;存储写入时长(分)&#39;</span>, <span style="color:#e6db74">&#39;存储-%CPU最大使用率&#39;</span>, <span style="color:#e6db74">&#39;存储-CPU最大负载(1分钟)&#39;</span>, <span style="color:#e6db74">&#39;存储-内存最大使用率-GiB&#39;</span> ];  <span style="color:#75715e">// 设置 X 轴上对应的标签
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_169_Data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c5_169_Labels</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">datasets</span><span style="color:#f92672">:</span> [{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;结果&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">11.16666667</span>, <span style="color:#ae81ff">0.906666667</span>, <span style="color:#ae81ff">6.707091217</span>, <span style="color:#ae81ff">53.87263617</span>, <span style="color:#ae81ff">8.97</span>, <span style="color:#ae81ff">69.28666667</span>, <span style="color:#ae81ff">1.86</span>, <span style="color:#ae81ff">10.61666667</span>, <span style="color:#ae81ff">0.555555556</span>, <span style="color:#ae81ff">20.66666667</span>, <span style="color:#ae81ff">1.936666667</span>, <span style="color:#ae81ff">24.95719945</span>],
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">backgroundColor</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>	  <span style="color:#e6db74">&#39;rgba(255, 99, 132, 0.2)&#39;</span>, <span style="color:#75715e">// 粉色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(255, 159, 64, 0.2)&#39;</span>,  <span style="color:#75715e">// 橙色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(255, 205, 86, 0.2)&#39;</span>,  <span style="color:#75715e">// 浅黄色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(75, 192, 192, 0.2)&#39;</span>,  <span style="color:#75715e">// 青绿色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(153, 102, 255, 0.2)&#39;</span>, <span style="color:#75715e">// 紫罗兰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(255, 206, 86, 0.2)&#39;</span>,  <span style="color:#75715e">// 金色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(75, 191, 92, 0.2)&#39;</span>,   <span style="color:#75715e">// 橄榄绿
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(120, 75, 192, 0.2)&#39;</span>,  <span style="color:#75715e">// 深紫罗兰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(255, 92, 159, 0.2)&#39;</span>,  <span style="color:#75715e">// 品红色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(92, 255, 206, 0.2)&#39;</span>,  <span style="color:#75715e">// 浅绿松石色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(206, 92, 255, 0.2)&#39;</span>,  <span style="color:#75715e">// 浅洋红色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(159, 255, 92, 0.2)&#39;</span>,  <span style="color:#75715e">// 浅黄色绿色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgba(102, 86, 255, 0.2)&#39;</span>   <span style="color:#75715e">// 浅灰蓝色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	],
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">borderColor</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>	  <span style="color:#e6db74">&#39;rgb(255, 99, 132)&#39;</span>,  <span style="color:#75715e">// 粉色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(255, 159, 64)&#39;</span>,   <span style="color:#75715e">// 橙色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(255, 205, 86)&#39;</span>,   <span style="color:#75715e">// 浅黄色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(75, 192, 192)&#39;</span>,   <span style="color:#75715e">// 青绿色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(153, 102, 255)&#39;</span>,  <span style="color:#75715e">// 紫罗兰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(255, 206, 86)&#39;</span>,   <span style="color:#75715e">// 金色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(75, 191, 92)&#39;</span>,    <span style="color:#75715e">// 橄榄绿
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(120, 75, 192)&#39;</span>,   <span style="color:#75715e">// 深紫罗兰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(255, 92, 159)&#39;</span>,   <span style="color:#75715e">// 品红色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(92, 255, 206)&#39;</span>,   <span style="color:#75715e">// 浅绿松石色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(206, 92, 255)&#39;</span>,   <span style="color:#75715e">// 浅洋红色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(159, 255, 92)&#39;</span>,   <span style="color:#75715e">// 浅黄色绿色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	  <span style="color:#e6db74">&#39;rgb(102, 86, 255)&#39;</span>    <span style="color:#75715e">// 浅灰蓝色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>     <span style="color:#75715e">// 设置线条宽度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }]
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_169_Config</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;bar&#39;</span>, <span style="color:#75715e">// 设置图表类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c5_169_Data</span>,  <span style="color:#75715e">// 设置数据集
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">options</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scales</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">beginAtZero</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> <span style="color:#75715e">// 设置 y 轴从 0 开始
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">display</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#75715e">// 这里设置图表的标题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">datalabels</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">anchor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;end&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">align</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;top&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">formatter</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">context</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">toFixed</span>(<span style="color:#ae81ff">2</span>); <span style="color:#75715e">// 设置标签格式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">ChartDataLabels</span>]
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_169_Chart</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Chart</span>(<span style="color:#a6e22e">c5_169_Ctx</span>, <span style="color:#a6e22e">c5_169_Config</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_165_ctx</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;c5_165&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_165_labels</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;avg-wMB/s&#39;</span>, <span style="color:#e6db74">&#39;min-wMB/s&#39;</span>, <span style="color:#e6db74">&#39;max-wMB/s&#39;</span>,<span style="color:#e6db74">&#39;avg-w_await&#39;</span>, <span style="color:#e6db74">&#39;min-w_await&#39;</span>, <span style="color:#e6db74">&#39;max-w_await&#39;</span>, <span style="color:#e6db74">&#39;avg-%util&#39;</span>, <span style="color:#e6db74">&#39;min-%util&#39;</span>, <span style="color:#e6db74">&#39;max-%util&#39;</span>];  <span style="color:#75715e">// 设置 X 轴上对应的标签
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_165_data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c5_165_labels</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">datasets</span><span style="color:#f92672">:</span> [{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sdb&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">52.36925926</span>, <span style="color:#ae81ff">5.89</span>, <span style="color:#ae81ff">83.85</span>, <span style="color:#ae81ff">28.26445534</span>, <span style="color:#ae81ff">8.703333333</span>, <span style="color:#ae81ff">59.62</span>, <span style="color:#ae81ff">89.57178649</span>, <span style="color:#ae81ff">28.28333333</span>, <span style="color:#ae81ff">98.7</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">backgroundColor</span><span style="color:#f92672">:</span> [      <span style="color:#75715e">// 设置每个柱形图的背景颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#e6db74">&#39;rgba(55, 163, 236, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(76, 193, 192, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(256, 205, 87, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(152, 103, 254, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 65, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 100, 133, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(154, 101, 254, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 66, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 98, 133, 0.2)&#39;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderColor</span><span style="color:#f92672">:</span> [     <span style="color:#75715e">//设置每个柱形图边框线条颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#e6db74">&#39;rgba(55, 163, 236)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(76, 193, 192)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(256, 205, 87)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(152, 103, 254)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 65)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 100, 133)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(154, 101, 254)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 66)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 98, 133)&#39;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>     <span style="color:#75715e">// 设置线条宽度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sdc&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">52.37021786</span>, <span style="color:#ae81ff">6.886666667</span>, <span style="color:#ae81ff">83.69333333</span>, <span style="color:#ae81ff">26.18413943</span>, <span style="color:#ae81ff">7.443333333</span>, <span style="color:#ae81ff">60.51333333</span>, <span style="color:#ae81ff">87.21247277</span>, <span style="color:#ae81ff">23.35</span>, <span style="color:#ae81ff">97.43333333</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">backgroundColor</span><span style="color:#f92672">:</span> [      <span style="color:#75715e">// 设置每个柱形图的背景颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#e6db74">&#39;rgba(55, 163, 236, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(76, 193, 192, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(256, 205, 87, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(152, 103, 254, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 65, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 100, 133, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(154, 101, 254, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 66, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 98, 133, 0.2)&#39;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderColor</span><span style="color:#f92672">:</span> [     <span style="color:#75715e">//设置每个柱形图边框线条颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#e6db74">&#39;rgba(55, 163, 236)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(76, 193, 192)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(256, 205, 87)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(152, 103, 254)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 65)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 100, 133)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(154, 101, 254)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 66)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 98, 133)&#39;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>     <span style="color:#75715e">// 设置线条宽度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;sdd&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> [<span style="color:#ae81ff">52.37001089</span>, <span style="color:#ae81ff">6.553333333</span>, <span style="color:#ae81ff">83.18666667</span>, <span style="color:#ae81ff">26.98811547</span>, <span style="color:#ae81ff">8.673333333</span>, <span style="color:#ae81ff">56.51</span>, <span style="color:#ae81ff">89.42472767</span>, <span style="color:#ae81ff">26.16666667</span>, <span style="color:#ae81ff">98.3</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">backgroundColor</span><span style="color:#f92672">:</span> [      <span style="color:#75715e">// 设置每个柱形图的背景颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#e6db74">&#39;rgba(55, 163, 236, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(76, 193, 192, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(256, 205, 87, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(152, 103, 254, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 65, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 100, 133, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(154, 101, 254, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 66, 0.2)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 98, 133, 0.2)&#39;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderColor</span><span style="color:#f92672">:</span> [     <span style="color:#75715e">//设置每个柱形图边框线条颜色
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#e6db74">&#39;rgba(55, 163, 236)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(76, 193, 192)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(256, 205, 87)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(152, 103, 254)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 65)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 100, 133)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(154, 101, 254)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 160, 66)&#39;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;rgba(254, 98, 133)&#39;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">borderWidth</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>     <span style="color:#75715e">// 设置线条宽度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }]
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_165_config</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;bar&#39;</span>, <span style="color:#75715e">// 设置图表类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">c5_165_data</span>,  <span style="color:#75715e">// 设置数据集
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">options</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scales</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">beginAtZero</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> <span style="color:#75715e">// 设置 y 轴从 0 开始
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">display</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;存储-硬盘信息&#39;</span> <span style="color:#75715e">// 这里设置图表的标题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">datalabels</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">anchor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;end&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">align</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;top&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">formatter</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">context</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">toFixed</span>(<span style="color:#ae81ff">2</span>); <span style="color:#75715e">// 设置标签格式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">ChartDataLabels</span>]
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c5_165_Chart</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Chart</span>(<span style="color:#a6e22e">c5_165_ctx</span>, <span style="color:#a6e22e">c5_165_config</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><div class="bigImg"><img loading="lazy" src="4.png" alt=""  /></div>
</p>
<p>效果还是挺好的。</p>
<br>

<img src="/img/favicon.png" alt="">

<hr>

			<span style="font-size:0.8rem;">© 转载需要保留原始链接，未经明确许可，禁止商业使用。<a class="link" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh-hans" target="_blank" rel="noopener">CC BY-NC-ND 4.0</a></span>
        </div>

        <footer class="post-footer">
            


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 记一次性能测试 on twitter"
       href="https://twitter.com/intent/tweet/?text=%e8%ae%b0%e4%b8%80%e6%ac%a1%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95&amp;url=http%3a%2f%2f192.168.9.98%2fposts%2ftechnology%2fessays%2fperformance%2f&amp;hashtags=%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95">
    <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 记一次性能测试 on linkedin"
       href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2f192.168.9.98%2fposts%2ftechnology%2fessays%2fperformance%2f&amp;title=%e8%ae%b0%e4%b8%80%e6%ac%a1%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95&amp;summary=%e8%ae%b0%e4%b8%80%e6%ac%a1%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95&amp;source=http%3a%2f%2f192.168.9.98%2fposts%2ftechnology%2fessays%2fperformance%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 记一次性能测试 on reddit"
       href="https://reddit.com/submit?url=http%3a%2f%2f192.168.9.98%2fposts%2ftechnology%2fessays%2fperformance%2f&title=%e8%ae%b0%e4%b8%80%e6%ac%a1%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 记一次性能测试 on facebook"
       href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2f192.168.9.98%2fposts%2ftechnology%2fessays%2fperformance%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 记一次性能测试 on whatsapp"
       href="https://api.whatsapp.com/send?text=%e8%ae%b0%e4%b8%80%e6%ac%a1%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95%20-%20http%3a%2f%2f192.168.9.98%2fposts%2ftechnology%2fessays%2fperformance%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 记一次性能测试 on telegram"
       href="https://telegram.me/share/url?text=%e8%ae%b0%e4%b8%80%e6%ac%a1%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95&amp;url=http%3a%2f%2f192.168.9.98%2fposts%2ftechnology%2fessays%2fperformance%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2024-2024
        <a href="http://192.168.9.98/" style="color:#939393;">𝙅𝙕𝙔&#39;𝙨 𝘽𝙡𝙤𝙜𝙨</a>
        版权所有
    </span>
	<span class="running-time">
	&emsp;本博客已稳定运行
	<span id="runningdays" class="running-days"></span>
		
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		
			
		&emsp;💭 11篇文章&emsp;⌨ 39.50k字
	</span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>
<script>
    let s1 = '2024-1-23'; 
    s1 = new Date(s1.replace(/-/g, "/"));
    let s2 = new Date();
    let timeDifference = s2.getTime() - s1.getTime();

    let days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
    let hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    let minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60)); 

    let result = days + "天" + hours + "小时" + minutes + "分钟";
    document.getElementById('runningdays').innerHTML = result;
</script>
<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"𝙅𝙕𝙔'𝙨 𝘽𝙡𝙤𝙜𝙨"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"𝙅𝙕𝙔'𝙨 𝘽𝙡𝙤𝙜𝙨"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;
    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = '复制';

    function copyingDone() {
        copybutton.innerText = '已复制！';
        setTimeout(() => {
            copybutton.innerText = '复制';
        }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
        if ('clipboard' in navigator) {
            let text = codeblock.textContent +
                '\r\n————————————————\r\n' +
                '版权声明：本文为「' + "𝙅𝙕𝙔'𝙨 𝘽𝙡𝙤𝙜𝙨" + '」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
            navigator.clipboard.writeText(text);
            copyingDone();
            return;
        }

        const range = document.createRange();
        range.selectNodeContents(codeblock);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        try {
            document.execCommand('copy');
            copyingDone();
        } catch (e) {}
        selection.removeRange(range);
    });

    
    let language = codeblock.className.split(" ").find(cls => cls.startsWith("language-"));
    if (language) {
        language = language.replace("language-", "");
    } else {
        language = ""; 
    }

    let macTool = document.createElement("div");
    let macTool1 = document.createElement("div");
    let macTool2 = document.createElement("div");
    let macTool3 = document.createElement("div");
    let languageType = document.createElement("div");
    languageType.innerText = language;
    macTool.setAttribute('class', 'mac-tool');
    macTool1.setAttribute('class', 'mac bb1');
    macTool2.setAttribute('class', 'mac bb2');
    macTool3.setAttribute('class', 'mac bb3');
    languageType.setAttribute('class', 'language-type');
    macTool.appendChild(macTool1);
    macTool.appendChild(macTool2);
    macTool.appendChild(macTool3);
    macTool.appendChild(languageType);

    if (container.classList.contains("highlight")) {
        container.appendChild(copybutton);
        container.appendChild(macTool);
    } else if (container.parentNode.firstChild == container) {
        
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
        
        codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        container.appendChild(macTool);
    } else {
        
        codeblock.parentNode.appendChild(copybutton);
        container.appendChild(macTool);
    }
	});

</script>
<script>
(function () {
  init();

  function init() {
    addZheZhao();
    addBigImgClick();
    yinCangZheZhao();
  }

  
  function addZheZhao() {
    let zhezhao2 = `
      <div id="zhezhao">
        <div id="xianshi">
          <img src="" id="bigImgbei" alt="" />
          <button style="color: #f10707;position: absolute;top: 0;right: 0;text-align: center;background-color: #fff;border-radius: 5px;border: none;outline: none;cursor: pointer;padding: 5px;" id="close">X</button>
        </div>
		
      </div>
    `;

    var div = document.createElement("div"); 
    div.innerHTML = zhezhao2;
    document.body.appendChild(div); 
  }

  
  function addBigImgClick() {
    
    let bigImgs = document.querySelectorAll(".bigImg img");
    console.log(bigImgs);

    
    bigImgs.forEach((item) => {
      item.onclick = function (e) {
        console.log("bigImg");
        
        

        
        let imgSrc = e.target.getAttribute("src");
        displayImage(imgSrc);
      };
    });
  }

  
  function displayImage(imgSrc) {
    
    document.getElementById("zhezhao").style.display = "block";
    
    document.getElementById("bigImgbei").src = imgSrc;
  }

  
  function yinCangZheZhao() {
    console.log("yinCangZheZhao");
    let yinCang = document.querySelector("#close");
    yinCang.onclick = yinCangHanShu;
  }

  function yinCangHanShu() {
    document.getElementById("zhezhao").style.display = "none";
  }

})();
</script>

</body>

</html>
